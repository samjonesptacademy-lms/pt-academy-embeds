<div id="pt-pnl-tabs-widget" class="ptpnl" role="region" aria-label="PT Academy: Interactive Profit & Loss with scenarios">
  <style>
    .ptpnl{
      --bg:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#2563eb;
      --good:#065f46;
      --bad:#7f1d1d;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      max-width:1020px;
      box-sizing:border-box;
    }
    .ptpnl *{box-sizing:border-box;}
    .ptpnl h2{margin:0 0 6px 0;font-size:18px;line-height:1.2;}
    .ptpnl .sub{margin:0 0 12px 0;color:var(--muted);font-size:13px;}

    .ptpnl .tabs{
      display:flex; flex-wrap:wrap; gap:8px;
      margin:10px 0 14px 0;
    }
    .ptpnl .tab{
      appearance:none; border:1px solid var(--line); background:#fff;
      padding:8px 10px; border-radius:999px; cursor:pointer;
      font-size:13px; color:#111827;
    }
    .ptpnl .tab[aria-selected="true"]{
      border-color: rgba(37,99,235,.45);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.12);
    }
    .ptpnl .tab:focus{outline:none; box-shadow: 0 0 0 3px rgba(37,99,235,0.18);}
    .ptpnl .tab small{display:block;color:var(--muted);font-size:11px;margin-top:2px;}

    .ptpnl .layout{display:grid; grid-template-columns: 1.6fr 1fr; gap:14px;}
    @media (max-width: 820px){ .ptpnl .layout{grid-template-columns:1fr;} }

    .ptpnl .card{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      background:#fff;
    }

    .ptpnl .assumptions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-bottom:12px;
    }
    @media (max-width: 520px){ .ptpnl .assumptions{grid-template-columns:1fr;} }
    .ptpnl label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px;}
    .ptpnl input{
      width:100%;
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 10px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    .ptpnl input:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
    }

    .ptpnl table{width:100%; border-collapse:collapse; font-size:14px;}
    .ptpnl th, .ptpnl td{border-bottom:1px solid var(--line); padding:10px 8px; vertical-align:middle;}
    .ptpnl th{text-align:left; font-size:12px; color:var(--muted); font-weight:600;}
    .ptpnl td.amount{text-align:right; white-space:nowrap; font-variant-numeric: tabular-nums;}

    .ptpnl .section{background:#f9fafb; font-weight:700; color:#111827;}
    .ptpnl .total{font-weight:800;}
    .ptpnl .total.good{color:var(--good);}
    .ptpnl .total.bad{color:var(--bad);}

    .ptpnl .rowhead{display:flex; align-items:center; gap:6px;}
    .ptpnl .hs{
      appearance:none; border:none; background:transparent; cursor:pointer;
      padding:0; margin-left:6px; vertical-align:middle; border-radius:999px;
    }
    .ptpnl .hs:focus{outline:none; box-shadow: 0 0 0 3px rgba(37,99,235,0.18);}
    .ptpnl .dot{
      display:inline-grid; place-items:center;
      width:18px; height:18px; border-radius:999px;
      border:1px solid var(--accent); color:var(--accent);
      font-size:12px; font-weight:700; line-height:1;
    }

    .ptpnl .pill{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      border:1px solid var(--line);
      background:#fff;
      color:var(--muted);
    }
    .ptpnl .pill.good{border-color: rgba(16,185,129,.35); color:#065f46; background: rgba(16,185,129,.08);}
    .ptpnl .pill.mid{border-color: rgba(245,158,11,.35); color:#7c2d12; background: rgba(245,158,11,.08);}
    .ptpnl .pill.bad{border-color: rgba(239,68,68,.35); color:#7f1d1d; background: rgba(239,68,68,.08);}

    .ptpnl .explain h3{margin:0 0 6px 0;font-size:15px;}
    .ptpnl .explain .meta{margin:0 0 10px 0;color:var(--muted);font-size:12px;}
    .ptpnl .explain p{margin:0 0 10px 0;font-size:13px;color:#111827;line-height:1.4;}
    .ptpnl .explain ul{margin:0; padding-left:18px; color:#111827; font-size:13px; line-height:1.4;}
    .ptpnl .hint{margin-top:10px; font-size:12px; color:var(--muted);}
    .ptpnl .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      border:1px solid var(--line);
      border-bottom-width:2px;
      padding:1px 6px;
      border-radius:6px;
      background:#fff;
      color:#111827;
      font-size:11px;
    }
    .ptpnl .footer{margin-top:10px; font-size:12px; color:var(--muted);}
  </style>

  <h2>Interactive Profit &amp; Loss (Personal Trainer) — Scenario Tabs</h2>
  <p class="sub">
    Pick a scenario, then adjust the inputs. Click the <span class="dot" aria-hidden="true">i</span> hotspots to learn what each line means.
  </p>

  <div class="tabs" role="tablist" aria-label="Scenario tabs">
    <button class="tab" role="tab" data-scn="gym_flat" aria-selected="true">
      In-gym (Flat rent) <small>Higher risk, higher upside</small>
    </button>
    <button class="tab" role="tab" data-scn="gym_split" aria-selected="false">
      In-gym (Revenue split) <small>More flexible, less upside</small>
    </button>
    <button class="tab" role="tab" data-scn="mobile" aria-selected="false">
      Mobile PT <small>More travel, less rent</small>
    </button>
    <button class="tab" role="tab" data-scn="hybrid" aria-selected="false">
      Hybrid (1:1 + online) <small>More scalable mix</small>
    </button>
  </div>

  <div class="layout">
    <!-- LEFT: Inputs + P&L -->
    <div class="card">
      <div class="assumptions" aria-label="Assumptions">
        <div>
          <label for="sessionsPerWeek">Sessions per week</label>
          <input id="sessionsPerWeek" type="number" min="0" step="1" value="18" inputmode="numeric" />
        </div>
        <div>
          <label for="pricePerSession">Average price per session (£)</label>
          <input id="pricePerSession" type="number" min="0" step="1" value="45" inputmode="decimal" />
        </div>
        <div>
          <label for="weeksPerMonth">Billable weeks per month</label>
          <input id="weeksPerMonth" type="number" min="0" step="0.1" value="4.0" inputmode="decimal" />
        </div>
        <div>
          <label for="otherIncome">Other income (monthly) (£)</label>
          <input id="otherIncome" type="number" min="0" step="1" value="120" inputmode="decimal" />
        </div>
      </div>

      <table aria-label="P&L table">
        <thead>
          <tr>
            <th>Line item</th>
            <th class="amount">Monthly (£)</th>
          </tr>
        </thead>
        <tbody>
          <tr class="section">
            <td>
              <span class="rowhead">
                Revenue
                <button class="hs" type="button" data-topic="revenue" aria-label="Learn more about Revenue"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount" id="revTotal">—</td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                1:1 session income
                <button class="hs" type="button" data-topic="sessions" aria-label="Learn more about 1 to 1 session income"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount" id="revSessions">—</td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Other income (online plans, small group, etc.)
                <button class="hs" type="button" data-topic="otherIncome" aria-label="Learn more about other income"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount" id="revOther">—</td>
          </tr>

          <tr class="section">
            <td>
              <span class="rowhead">
                Cost of sales / Direct costs
                <button class="hs" type="button" data-topic="directCosts" aria-label="Learn more about direct costs"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount" id="directTotal">—</td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Facility cost (rent / floor fee / split)
                <button class="hs" type="button" data-topic="facility" aria-label="Learn more about facility costs"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount">
              <input id="facilityCost" type="number" min="0" step="1" value="450" aria-label="Facility cost monthly pounds" />
            </td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Payment processing fees
                <button class="hs" type="button" data-topic="processing" aria-label="Learn more about payment processing fees"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><input id="processingFees" type="number" min="0" step="1" value="55" aria-label="Payment processing fees monthly pounds" /></td>
          </tr>

          <tr class="section">
            <td>
              <span class="rowhead">
                Operating expenses (Overheads)
                <button class="hs" type="button" data-topic="overheads" aria-label="Learn more about operating expenses"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount" id="overheadTotal">—</td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Insurance
                <button class="hs" type="button" data-topic="insurance" aria-label="Learn more about insurance"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><input id="insurance" type="number" min="0" step="1" value="18" aria-label="Insurance monthly pounds" /></td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Marketing &amp; advertising
                <button class="hs" type="button" data-topic="marketing" aria-label="Learn more about marketing and advertising"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><input id="marketing" type="number" min="0" step="1" value="120" aria-label="Marketing monthly pounds" /></td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Software &amp; tools
                <button class="hs" type="button" data-topic="software" aria-label="Learn more about software and tools"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><input id="software" type="number" min="0" step="1" value="45" aria-label="Software monthly pounds" /></td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                CPD / education
                <button class="hs" type="button" data-topic="cpd" aria-label="Learn more about CPD"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><input id="cpd" type="number" min="0" step="1" value="35" aria-label="CPD monthly pounds" /></td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Travel
                <button class="hs" type="button" data-topic="travel" aria-label="Learn more about travel costs"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><input id="travel" type="number" min="0" step="1" value="60" aria-label="Travel monthly pounds" /></td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Equipment &amp; supplies
                <button class="hs" type="button" data-topic="equipment" aria-label="Learn more about equipment and supplies"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><input id="equipment" type="number" min="0" step="1" value="40" aria-label="Equipment monthly pounds" /></td>
          </tr>

          <tr class="section total">
            <td>
              <span class="rowhead">
                Net profit (before tax)
                <button class="hs" type="button" data-topic="profit" aria-label="Learn more about net profit"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount" id="netProfit">—</td>
          </tr>
          <tr>
            <td>
              <span class="rowhead">
                Net margin
                <button class="hs" type="button" data-topic="margin" aria-label="Learn more about net margin"><span class="dot">i</span></button>
              </span>
            </td>
            <td class="amount"><span id="netMarginPill" class="pill">—</span></td>
          </tr>
        </tbody>
      </table>

      <div class="footer" id="scenarioNote">Scenario note: —</div>
    </div>

    <!-- RIGHT: Explain panel -->
    <div class="card explain" aria-live="polite">
      <h3 id="expTitle">Hotspot explanations</h3>
      <p class="meta" id="expMeta">Click any <span class="dot" aria-hidden="true">i</span> to load an explanation here.</p>
      <p id="expBody">Use this panel for short “what it is / why it matters / what good looks like”.</p>
      <ul id="expBullets"></ul>
      <div class="hint">Keyboard: <span class="kbd">Tab</span> → focus, <span class="kbd">Enter</span> / <span class="kbd">Space</span> → open.</div>
    </div>
  </div>

  <script>
    (function(){
      const root = document.getElementById('pt-pnl-tabs-widget');

      // --- Helpers ---
      const £ = (n) => {
        const x = isFinite(n) ? n : 0;
        return x.toLocaleString('en-GB', { style:'currency', currency:'GBP', maximumFractionDigits:0 });
      };
      const num = (id) => {
        const el = root.querySelector('#' + id);
        const v = parseFloat(el.value);
        return isFinite(v) ? v : 0;
      };
      const setText = (id, text) => root.querySelector('#' + id).textContent = text;

      // --- Scenarios (starting points) ---
      // Note: these are illustrative. In real life, rent/split and travel can dwarf other lines.
      const scenarios = {
        gym_flat: {
          label: "In-gym (Flat rent)",
          note: "Flat facility cost each month. Profit swings with utilisation (busy month vs quiet month).",
          defaults: { sessionsPerWeek: 18, pricePerSession: 45, weeksPerMonth: 4.0, otherIncome: 120,
                     facilityCost: 450, processingFees: 55, insurance: 18, marketing: 120, software: 45, cpd: 35, travel: 40, equipment: 40 }
        },
        gym_split: {
          label: "In-gym (Revenue split)",
          note: "Facility cost behaves more like a variable cost. Upside is limited, downside is cushioned.",
          defaults: { sessionsPerWeek: 18, pricePerSession: 45, weeksPerMonth: 4.0, otherIncome: 80,
                     facilityCost: 0, processingFees: 55, insurance: 18, marketing: 120, software: 45, cpd: 35, travel: 40, equipment: 40 },
          // Special behaviour: facilityCost becomes a % of revenue (editable constant in code)
          facilitySplitPct: 0.30
        },
        mobile: {
          label: "Mobile PT",
          note: "Lower facility cost, higher travel time/costs. Pricing usually needs to reflect travel overhead.",
          defaults: { sessionsPerWeek: 14, pricePerSession: 60, weeksPerMonth: 3.8, otherIncome: 60,
                     facilityCost: 30, processingFees: 45, insurance: 22, marketing: 160, software: 45, cpd: 35, travel: 180, equipment: 55 }
        },
        hybrid: {
          label: "Hybrid (1:1 + online)",
          note: "Adds scalable income but may increase software and marketing. Watch delivery time creep.",
          defaults: { sessionsPerWeek: 14, pricePerSession: 55, weeksPerMonth: 4.0, otherIncome: 350,
                     facilityCost: 350, processingFees: 65, insurance: 18, marketing: 180, software: 65, cpd: 35, travel: 50, equipment: 40 }
        }
      };

      // --- Explanations (hotspots) ---
      const topics = {
        revenue: {
          title: "Revenue",
          meta: "Total income for the month (before costs).",
          body: "Revenue is what comes in. The trap is assuming revenue equals take-home pay—costs, tax, and cashflow timing matter.",
          bullets: [
            "Split revenue by product (1:1, small group, online) so you can see what is actually profitable.",
            "Stability often improves with retainers/memberships versus ad hoc sessions.",
            "Always sanity-check capacity: you can’t scale 1:1 indefinitely."
          ]
        },
        sessions: {
          title: "1:1 session income",
          meta: "Sessions × price × billable weeks.",
          body: "For many PTs this is the main driver. It’s also the hardest to scale without raising price or changing delivery.",
          bullets: [
            "Billable weeks aren’t always 4.0: holidays and cancellations reduce it.",
            "Packages/memberships can reduce volatility.",
            "Monitor effective hourly rate (including admin and travel)."
          ]
        },
        otherIncome: {
          title: "Other income",
          meta: "Online coaching, small group, programmes, etc.",
          body: "This can improve margin if it scales without matching increases in time. But it can also hide extra delivery workload.",
          bullets: [
            "Be honest about time cost (check-ins, messaging, programme edits).",
            "Price and scope-control prevent over-serving.",
            "Retention (churn) is the key metric for recurring income."
          ]
        },
        directCosts: {
          title: "Direct costs (Cost of sales)",
          meta: "Costs closely linked to delivering the service.",
          body: "These are the costs you generally wouldn’t have (or would be much lower) if you had no clients.",
          bullets: [
            "Direct costs help you calculate gross profit (Revenue − Direct costs).",
            "Facility terms are often the biggest lever to improve profitability.",
            "Some costs scale with revenue (processing fees, revenue splits)."
          ]
        },
        facility: {
          title: "Facility cost (rent / floor fee / split)",
          meta: "Flat rent, per-session fee, or a % split.",
          body: "The structure changes your risk profile: flat rent punishes quiet months, but boosts profit in busy months. A split does the opposite.",
          bullets: [
            "Flat rent: higher fixed commitment, higher upside when you’re fully booked.",
            "Revenue split: safer when starting, but you may ‘pay more’ at scale.",
            "Always weigh it against what you get: leads, space, equipment, admin support."
          ]
        },
        processing: {
          title: "Payment processing fees",
          meta: "Card/direct debit provider fees.",
          body: "These often get ignored, but they scale with revenue and can change your net receipts.",
          bullets: [
            "Fees can be % + fixed amount per transaction.",
            "Fewer, larger payments can reduce per-transaction fixed fees.",
            "Reconcile fees monthly so you understand true net income."
          ]
        },
        overheads: {
          title: "Operating expenses (Overheads)",
          meta: "Running costs that aren’t directly ‘per client’.",
          body: "Overheads include insurance, tools, marketing, education, and day-to-day business costs.",
          bullets: [
            "Cutting overheads can increase profit short-term but may slow growth.",
            "Subscriptions tend to creep—review them quarterly.",
            "Marketing is only ‘expense’ if you aren’t measuring outcomes."
          ]
        },
        insurance: {
          title: "Insurance",
          meta: "Professional indemnity/public liability (etc.).",
          body: "Low monthly cost, high downside protection. Coverage varies by activity and setting.",
          bullets: [
            "Check exclusions and coverage for your services (e.g., outdoor sessions).",
            "Keep proof available if facilities require it.",
            "Review annually as your services evolve."
          ]
        },
        marketing: {
          title: "Marketing & advertising",
          meta: "Paid ads, platforms, content, brand assets.",
          body: "Marketing should create measurable demand. If spend isn’t linked to leads, conversions, or retention, it becomes guesswork.",
          bullets: [
            "Track cost per lead and cost per client.",
            "Retention and referrals often outperform acquisition spend.",
            "Consistency beats occasional ‘bursts’ for most local PTs."
          ]
        },
        software: {
          title: "Software & tools",
          meta: "Booking, coaching apps, CRM, accounts.",
          body: "Tools should buy back time or improve client experience. If a tool adds admin, it costs twice—money and attention.",
          bullets: [
            "Automations (reminders, booking) can reduce no-shows.",
            "Audit subscriptions regularly.",
            "Consider how easy it is to switch platforms later."
          ]
        },
        cpd: {
          title: "CPD / education",
          meta: "Courses, mentoring, conferences.",
          body: "CPD boosts capability and differentiation—if it translates into better outcomes, pricing power, or retention.",
          bullets: [
            "Choose CPD that removes a current constraint in the business.",
            "Apply learning quickly (offer, process, or service improvements).",
            "Avoid collecting certifications with no commercial impact."
          ]
        },
        travel: {
          title: "Travel",
          meta: "Fuel, transport, parking—and time.",
          body: "Travel can quietly destroy effective hourly rate, especially for mobile PT. Time is part of the cost even if it isn’t on the P&L.",
          bullets: [
            "Cluster sessions geographically.",
            "Price home visits with travel overhead in mind.",
            "Track expenses consistently."
          ]
        },
        equipment: {
          title: "Equipment & supplies",
          meta: "Small kit, replacements, consumables.",
          body: "Costs can be steady or ‘lumpy’ when you upgrade kit. Treat bigger purchases differently if your accounting separates capital spend.",
          bullets: [
            "Plan replacement cycles.",
            "Buy kit that matches what you actually sell.",
            "Keep receipts organised for claims and accounting."
          ]
        },
        profit: {
          title: "Net profit (before tax)",
          meta: "What’s left after expenses (before tax).",
          body: "Profit isn’t the same as cash. You can be ‘profitable’ and still struggle if payments arrive late or bills stack up.",
          bullets: [
            "Set aside tax as you go.",
            "Watch cashflow timing (when you get paid vs when you pay bills).",
            "Profit informs pay-yourself and reinvestment decisions."
          ]
        },
        margin: {
          title: "Net margin",
          meta: "Net profit ÷ revenue.",
          body: "Margin helps compare performance across months and models. Higher margin isn’t always ‘better’ if you’re investing for growth.",
          bullets: [
            "Low margin: check facility terms, pricing, and marketing efficiency.",
            "High margin but low revenue: you may have a demand or capacity constraint.",
            "Look at trends, not a single month."
          ]
        }
      };

      function showTopic(key){
        const t = topics[key] || topics.revenue;
        root.querySelector('#expTitle').textContent = t.title;
        root.querySelector('#expMeta').textContent = t.meta;
        root.querySelector('#expBody').textContent = t.body;
        const ul = root.querySelector('#expBullets');
        ul.innerHTML = '';
        (t.bullets || []).forEach(b => {
          const li = document.createElement('li');
          li.textContent = b;
          ul.appendChild(li);
        });
      }

      // --- Scenario application ---
      let activeScenarioKey = 'gym_flat';

      function setInput(id, value){
        const el = root.querySelector('#' + id);
        el.value = value;
      }

      function applyScenario(key){
        const s = scenarios[key] || scenarios.gym_flat;
        activeScenarioKey = key;

        // Set defaults
        Object.entries(s.defaults).forEach(([id, value]) => setInput(id, value));

        // Update scenario note
        root.querySelector('#scenarioNote').textContent = "Scenario note: " + s.note;

        // Update tab selected state
        root.querySelectorAll('.tab').forEach(btn => {
          const isActive = btn.dataset.scn === key;
          btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });

        recalc(); // refresh calculations (including split logic)
      }

      // --- Calculations ---
      function recalc(){
        const sessionsPerWeek = num('sessionsPerWeek');
        const pricePerSession = num('pricePerSession');
        const weeksPerMonth = num('weeksPerMonth');
        const otherIncome = num('otherIncome');

        const processingFees = num('processingFees');

        const insurance = num('insurance');
        const marketing = num('marketing');
        const software = num('software');
        const cpd = num('cpd');
        const travel = num('travel');
        const equipment = num('equipment');

        const revSessions = sessionsPerWeek * pricePerSession * weeksPerMonth;
        const revTotal = revSessions + otherIncome;

        // Facility cost behaviour depends on scenario
        const s = scenarios[activeScenarioKey];
        let facilityCost = num('facilityCost');

        if (activeScenarioKey === 'gym_split') {
          // Model facility cost as % of revenue (illustrative)
          const pct = (s && s.facilitySplitPct != null) ? s.facilitySplitPct : 0.30;
          facilityCost = revTotal * pct;
          // Show it in the input for transparency (but keep editable? we'll keep it read-only feel without disabling)
          root.querySelector('#facilityCost').value = Math.round(facilityCost);
        }

        const directTotal = facilityCost + processingFees;
        const overheadTotal = insurance + marketing + software + cpd + travel + equipment;

        const netProfit = revTotal - directTotal - overheadTotal;
        const margin = revTotal > 0 ? (netProfit / revTotal) : 0;

        setText('revSessions', £(revSessions));
        setText('revOther', £(otherIncome));
        setText('revTotal', £(revTotal));
        setText('directTotal', £(directTotal));
        setText('overheadTotal', £(overheadTotal));

        const profitEl = root.querySelector('#netProfit');
        profitEl.textContent = £(netProfit);
        profitEl.classList.toggle('good', netProfit >= 0);
        profitEl.classList.toggle('bad', netProfit < 0);

        const pill = root.querySelector('#netMarginPill');
        const pct = (margin * 100);
        pill.textContent = isFinite(pct) ? (pct.toFixed(0) + '%') : '—';
        pill.classList.remove('good','mid','bad');
        if (pct >= 35) pill.classList.add('good');
        else if (pct >= 15) pill.classList.add('mid');
        else pill.classList.add('bad');
      }

      // Wire up inputs
      root.querySelectorAll('input').forEach(i => i.addEventListener('input', recalc));

      // Wire up hotspots
      root.querySelectorAll('.hs').forEach(btn => {
        btn.addEventListener('click', () => showTopic(btn.dataset.topic));
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showTopic(btn.dataset.topic); }
        });
      });

      // Wire up tabs
      root.querySelectorAll('.tab').forEach(btn => {
        btn.addEventListener('click', () => applyScenario(btn.dataset.scn));
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); applyScenario(btn.dataset.scn); }
        });
      });

      // Initial
      applyScenario('gym_flat');
      showTopic('revenue');
    })();
  </script>
</div>
