<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PT Academy Interactive P&L</title>
</head>
<body style="margin:0; padding:16px; background:#fff;">

<div id="pt-pnl-tabs-widget" class="ptpnl" role="region" aria-label="PT Academy: Interactive Profit & Loss with scenarios">
  <style>
    .ptpnl{
      --bg:#ffffff; --ink:#1f2937; --muted:#6b7280; --line:#e5e7eb; --accent:#2563eb;
      --good:#065f46; --bad:#7f1d1d;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink); background:var(--bg);
      border:1px solid var(--line); border-radius:14px; padding:16px; max-width:1020px;
      box-sizing:border-box; margin:0 auto;
    }
    .ptpnl *{box-sizing:border-box;}
    .ptpnl h2{margin:0 0 6px 0;font-size:18px;line-height:1.2;}
    .ptpnl .sub{margin:0 0 12px 0;color:var(--muted);font-size:13px;}

    .ptpnl .tabs{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 14px 0;}
    .ptpnl .tab{
      appearance:none;border:1px solid var(--line);background:#fff;padding:8px 10px;border-radius:999px;
      cursor:pointer;font-size:13px;color:#111827;
    }
    .ptpnl .tab[aria-selected="true"]{border-color:rgba(37,99,235,.45); box-shadow:0 0 0 3px rgba(37,99,235,0.12);}
    .ptpnl .tab:focus{outline:none;box-shadow:0 0 0 3px rgba(37,99,235,0.18);}
    .ptpnl .tab small{display:block;color:var(--muted);font-size:11px;margin-top:2px;}

    .ptpnl .layout{display:grid;grid-template-columns:1.6fr 1fr;gap:14px;}
    @media (max-width:820px){.ptpnl .layout{grid-template-columns:1fr;}}

    .ptpnl .card{border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;}

    .ptpnl .assumptions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
    @media (max-width:520px){.ptpnl .assumptions{grid-template-columns:1fr;}}

    .ptpnl label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px;}
    .ptpnl input{
      width:100%;border:1px solid var(--line);border-radius:10px;padding:10px 10px;font-size:14px;
      outline:none;background:#fff;
    }
    .ptpnl input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,0.15);}

    .ptpnl table{width:100%;border-collapse:collapse;font-size:14px;}
    .ptpnl th,.ptpnl td{border-bottom:1px solid var(--line);padding:10px 8px;vertical-align:middle;}
    .ptpnl th{text-align:left;font-size:12px;color:var(--muted);font-weight:600;}
    .ptpnl td.amount{text-align:right;white-space:nowrap;font-variant-numeric:tabular-nums;}

    .ptpnl .section{background:#f9fafb;font-weight:700;color:#111827;}
    .ptpnl .total{font-weight:800;}
    .ptpnl .total.good{color:var(--good);}
    .ptpnl .total.bad{color:var(--bad);}

    .ptpnl .rowhead{display:flex;align-items:center;gap:6px;}
    .ptpnl .hs{appearance:none;border:none;background:transparent;cursor:pointer;padding:0;margin-left:6px;border-radius:999px;}
    .ptpnl .hs:focus{outline:none;box-shadow:0 0 0 3px rgba(37,99,235,0.18);}
    .ptpnl .dot{
      display:inline-grid;place-items:center;width:18px;height:18px;border-radius:999px;
      border:1px solid var(--accent);color:var(--accent);font-size:12px;font-weight:700;line-height:1;
    }

    .ptpnl .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;border:1px solid var(--line);background:#fff;color:var(--muted);}
    .ptpnl .pill.good{border-color:rgba(16,185,129,.35);color:#065f46;background:rgba(16,185,129,.08);}
    .ptpnl .pill.mid{border-color:rgba(245,158,11,.35);color:#7c2d12;background:rgba(245,158,11,.08);}
    .ptpnl .pill.bad{border-color:rgba(239,68,68,.35);color:#7f1d1d;background:rgba(239,68,68,.08);}

    .ptpnl .explain h3{margin:0 0 6px 0;font-size:15px;}
    .ptpnl .explain .meta{margin:0 0 10px 0;color:var(--muted);font-size:12px;}
    .ptpnl .explain p{margin:0 0 10px 0;font-size:13px;color:#111827;line-height:1.4;}
    .ptpnl .explain ul{margin:0;padding-left:18px;color:#111827;font-size:13px;line-height:1.4;}
    .ptpnl .hint{margin-top:10px;font-size:12px;color:var(--muted);}
    .ptpnl .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;border:1px solid var(--line);border-bottom-width:2px;padding:1px 6px;border-radius:6px;background:#fff;color:#111827;font-size:11px;}
    .ptpnl .footer{margin-top:10px;font-size:12px;color:var(--muted);}

    .ptpnl .debug{
      margin-top:10px; font-size:12px; color:var(--muted);
      border-top:1px dashed var(--line); padding-top:10px;
    }
  </style>

  <h2>Interactive Profit &amp; Loss (Personal Trainer) — Scenario Tabs</h2>
  <p class="sub">Pick a scenario, adjust the inputs, then click the <span class="dot" aria-hidden="true">i</span> hotspots for explanations.</p>

  <div class="tabs" role="tablist" aria-label="Scenario tabs">
    <button class="tab" role="tab" data-scn="gym_flat" aria-selected="true">In-gym (Flat rent) <small>Higher risk, higher upside</small></button>
    <button class="tab" role="tab" data-scn="gym_split" aria-selected="false">In-gym (Revenue split) <small>More flexible, less upside</small></button>
    <button class="tab" role="tab" data-scn="mobile" aria-selected="false">Mobile PT <small>More travel, less rent</small></button>
    <button class="tab" role="tab" data-scn="hybrid" aria-selected="false">Hybrid (1:1 + online) <small>More scalable mix</small></button>
  </div>

  <div class="layout">
    <div class="card">
      <div class="assumptions" aria-label="Assumptions">
        <div>
          <label for="sessionsPerWeek">Sessions per week</label>
          <input id="sessionsPerWeek" type="number" min="0" step="1" value="18" inputmode="numeric" />
        </div>
        <div>
          <label for="pricePerSession">Average price per session (£)</label>
          <input id="pricePerSession" type="number" min="0" step="1" value="45" inputmode="decimal" />
        </div>
        <div>
          <label for="weeksPerMonth">Billable weeks per month</label>
          <input id="weeksPerMonth" type="number" min="0" step="0.1" value="4.0" inputmode="decimal" />
        </div>
        <div>
          <label for="otherIncome">Other income (monthly) (£)</label>
          <input id="otherIncome" type="number" min="0" step="1" value="120" inputmode="decimal" />
        </div>
      </div>

      <table aria-label="P&L table">
        <thead>
          <tr><th>Line item</th><th class="amount">Monthly (£)</th></tr>
        </thead>
        <tbody>
          <tr class="section">
            <td><span class="rowhead">Revenue <button class="hs" type="button" data-topic="revenue"><span class="dot">i</span></button></span></td>
            <td class="amount" id="revTotal">—</td>
          </tr>
          <tr>
            <td><span class="rowhead">1:1 session income <button class="hs" type="button" data-topic="sessions"><span class="dot">i</span></button></span></td>
            <td class="amount" id="revSessions">—</td>
          </tr>
          <tr>
            <td><span class="rowhead">Other income <button class="hs" type="button" data-topic="otherIncome"><span class="dot">i</span></button></span></td>
            <td class="amount" id="revOther">—</td>
          </tr>

          <tr class="section">
            <td><span class="rowhead">Cost of sales / Direct costs <button class="hs" type="button" data-topic="directCosts"><span class="dot">i</span></button></span></td>
            <td class="amount" id="directTotal">—</td>
          </tr>
          <tr>
            <td><span class="rowhead">Facility cost <button class="hs" type="button" data-topic="facility"><span class="dot">i</span></button></span></td>
            <td class="amount"><input id="facilityCost" type="number" min="0" step="1" value="450" /></td>
          </tr>
          <tr>
            <td><span class="rowhead">Payment processing fees <button class="hs" type="button" data-topic="processing"><span class="dot">i</span></button></span></td>
            <td class="amount"><input id="processingFees" type="number" min="0" step="1" value="55" /></td>
          </tr>

          <tr class="section">
            <td><span class="rowhead">Operating expenses (Overheads) <button class="hs" type="button" data-topic="overheads"><span class="dot">i</span></button></span></td>
            <td class="amount" id="overheadTotal">—</td>
          </tr>
          <tr><td><span class="rowhead">Insurance <button class="hs" type="button" data-topic="insurance"><span class="dot">i</span></button></span></td><td class="amount"><input id="insurance" type="number" min="0" step="1" value="18" /></td></tr>
          <tr><td><span class="rowhead">Marketing &amp; advertising <button class="hs" type="button" data-topic="marketing"><span class="dot">i</span></button></span></td><td class="amount"><input id="marketing" type="number" min="0" step="1" value="120" /></td></tr>
          <tr><td><span class="rowhead">Software &amp; tools <button class="hs" type="button" data-topic="software"><span class="dot">i</span></button></span></td><td class="amount"><input id="software" type="number" min="0" step="1" value="45" /></td></tr>
          <tr><td><span class="rowhead">CPD / education <button class="hs" type="button" data-topic="cpd"><span class="dot">i</span></button></span></td><td class="amount"><input id="cpd" type="number" min="0" step="1" value="35" /></td></tr>
          <tr><td><span class="rowhead">Travel <button class="hs" type="button" data-topic="travel"><span class="dot">i</span></button></span></td><td class="amount"><input id="travel" type="number" min="0" step="1" value="60" /></td></tr>
          <tr><td><span class="rowhead">Equipment &amp; supplies <button class="hs" type="button" data-topic="equipment"><span class="dot">i</span></button></span></td><td class="amount"><input id="equipment" type="number" min="0" step="1" value="40" /></td></tr>

          <tr class="section total">
            <td><span class="rowhead">Net profit (before tax) <button class="hs" type="button" data-topic="profit"><span class="dot">i</span></button></span></td>
            <td class="amount" id="netProfit">—</td>
          </tr>
          <tr>
            <td><span class="rowhead">Net margin <button class="hs" type="button" data-topic="margin"><span class="dot">i</span></button></span></td>
            <td class="amount"><span id="netMarginPill" class="pill">—</span></td>
          </tr>
        </tbody>
      </table>

      <div class="footer" id="scenarioNote">Scenario note: —</div>
      <div class="debug" id="debugLine">Debug: (waiting for JS…)</div>
    </div>

    <div class="card explain" aria-live="polite">
      <h3 id="expTitle">Hotspot explanations</h3>
      <p class="meta" id="expMeta">Click any <span class="dot" aria-hidden="true">i</span> to load an explanation here.</p>
      <p id="expBody">—</p>
      <ul id="expBullets"></ul>
      <div class="hint">Keyboard: <span class="kbd">Tab</span> then <span class="kbd">Enter</span>.</div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const root = document.getElementById('pt-pnl-tabs-widget');
    if (!root) {
      console.error('PT P&L widget: root element not found.');
      return;
    }

    // If you see this change, JS is running.
    root.querySelector('#debugLine').textContent = 'Debug: JS is running ✔';

    const £ = (n) => (isFinite(n) ? n : 0).toLocaleString('en-GB', { style:'currency', currency:'GBP', maximumFractionDigits:0 });
    const getNum = (id) => {
      const el = root.querySelector('#' + id);
      if (!el) return 0;
      const v = parseFloat(el.value);
      return isFinite(v) ? v : 0;
    };
    const setText = (id, text) => {
      const el = root.querySelector('#' + id);
      if (el) el.textContent = text;
    };

    const scenarios = {
      gym_flat: {
        note: 'Flat facility cost each month. Profit swings with utilisation (busy vs quiet months).',
        defaults: { sessionsPerWeek:18, pricePerSession:45, weeksPerMonth:4.0, otherIncome:120, facilityCost:450, processingFees:55, insurance:18, marketing:120, software:45, cpd:35, travel:40, equipment:40 }
      },
      gym_split: {
        note: 'Facility cost modelled as a % of revenue (variable). Upside is limited, downside cushioned.',
        defaults: { sessionsPerWeek:18, pricePerSession:45, weeksPerMonth:4.0, otherIncome:80, facilityCost:0, processingFees:55, insurance:18, marketing:120, software:45, cpd:35, travel:40, equipment:40 },
        facilitySplitPct: 0.30
      },
      mobile: {
        note: 'Lower facility cost, higher travel. Pricing usually needs to reflect travel overhead.',
        defaults: { sessionsPerWeek:14, pricePerSession:60, weeksPerMonth:3.8, otherIncome:60, facilityCost:30, processingFees:45, insurance:22, marketing:160, software:45, cpd:35, travel:180, equipment:55 }
      },
      hybrid: {
        note: 'Adds scalable income but may increase software and marketing. Watch delivery time creep.',
        defaults: { sessionsPerWeek:14, pricePerSession:55, weeksPerMonth:4.0, otherIncome:350, facilityCost:350, processingFees:65, insurance:18, marketing:180, software:65, cpd:35, travel:50, equipment:40 }
      }
    };

    const topics = {
      revenue: { title:'Revenue', meta:'Total income before costs.', body:'Revenue is what comes in. It is not take-home pay.', bullets:['Separate revenue streams so you can see what drives profit.'] },
      sessions: { title:'1:1 session income', meta:'Sessions × price × billable weeks.', body:'Main driver for many PTs; hardest to scale without changing the model.', bullets:['Billable weeks are rarely a perfect 4.0.'] },
      otherIncome: { title:'Other income', meta:'Online coaching, small group, programmes.', body:'Can improve margin if it scales without matching time increases.', bullets:['Be honest about delivery time.'] },
      directCosts: { title:'Direct costs', meta:'Costs tied to delivering service.', body:'Often facility costs + transaction fees for PTs.', bullets:['Facility terms are a major profit lever.'] },
      facility: { title:'Facility cost', meta:'Rent / floor fee / revenue split.', body:'The structure changes risk: flat rent = more fixed cost; split = more variable.', bullets:['Compare what you get for the fee (leads, facilities, admin).'] },
      processing: { title:'Processing fees', meta:'Card/direct debit fees.', body:'Often ignored, but they scale with revenue.', bullets:['Reconcile fees so you know true net receipts.'] },
      overheads: { title:'Overheads', meta:'Running costs not “per client”.', body:'Insurance, tools, marketing, CPD, travel, supplies.', bullets:['Subscriptions creep—review quarterly.'] },
      insurance: { title:'Insurance', meta:'Protection for you and clients.', body:'Low monthly cost, high downside protection.', bullets:['Check coverage matches your services.'] },
      marketing: { title:'Marketing', meta:'Paid ads, platforms, brand assets.', body:'Should link to leads, conversions, or retention.', bullets:['Track cost per lead and cost per client.'] },
      software: { title:'Software', meta:'Booking, coaching apps, CRM.', body:'Should save time or improve service quality.', bullets:['Audit tools regularly.'] },
      cpd: { title:'CPD', meta:'Education, mentoring, courses.', body:'Best when it removes a current business constraint.', bullets:['Apply learning quickly to see commercial impact.'] },
      travel: { title:'Travel', meta:'Fuel, parking, public transport—and time.', body:'Travel time reduces effective hourly rate.', bullets:['Cluster sessions geographically.'] },
      equipment: { title:'Equipment', meta:'Kit, replacements, supplies.', body:'Costs can be steady or “lumpy” with upgrades.', bullets:['Plan replacement cycles.'] },
      profit: { title:'Net profit', meta:'Before tax.', body:'Profit is not the same as cash; timing matters.', bullets:['Set aside tax as you go.'] },
      margin: { title:'Net margin', meta:'Profit ÷ revenue.', body:'Helps compare performance across months and models.', bullets:['Look at trends, not one month.'] }
    };

    function showTopic(key){
      const t = topics[key] || topics.revenue;
      root.querySelector('#expTitle').textContent = t.title;
      root.querySelector('#expMeta').textContent = t.meta;
      root.querySelector('#expBody').textContent = t.body;
      const ul = root.querySelector('#expBullets');
      ul.innerHTML = '';
      (t.bullets || []).forEach(b => {
        const li = document.createElement('li');
        li.textContent = b;
        ul.appendChild(li);
      });
    }

    let activeScenarioKey = 'gym_flat';

    function setInputs(defaults){
      Object.entries(defaults).forEach(([id, value]) => {
        const el = root.querySelector('#' + id);
        if (el) el.value = value;
      });
    }

    function recalc(){
      const s = scenarios[activeScenarioKey];

      const sessionsPerWeek = getNum('sessionsPerWeek');
      const pricePerSession = getNum('pricePerSession');
      const weeksPerMonth = getNum('weeksPerMonth');
      const otherIncome = getNum('otherIncome');

      const processingFees = getNum('processingFees');

      const insurance = getNum('insurance');
      const marketing = getNum('marketing');
      const software = getNum('software');
      const cpd = getNum('cpd');
      const travel = getNum('travel');
      const equipment = getNum('equipment');

      const revSessions = sessionsPerWeek * pricePerSession * weeksPerMonth;
      const revTotal = revSessions + otherIncome;

      let facilityCost = getNum('facilityCost');
      const facilityEl = root.querySelector('#facilityCost');

      if (activeScenarioKey === 'gym_split') {
        const pct = (s && s.facilitySplitPct != null) ? s.facilitySplitPct : 0.30;
        facilityCost = revTotal * pct;
        if (facilityEl) {
          facilityEl.value = Math.round(facilityCost);
          facilityEl.readOnly = true;
          facilityEl.title = 'In this scenario, facility cost is calculated as a % of revenue.';
        }
      } else {
        if (facilityEl) {
          facilityEl.readOnly = false;
          facilityEl.title = '';
        }
      }

      const directTotal = facilityCost + processingFees;
      const overheadTotal = insurance + marketing + software + cpd + travel + equipment;

      const netProfit = revTotal - directTotal - overheadTotal;
      const margin = revTotal > 0 ? (netProfit / revTotal) : 0;

      setText('revSessions', £(revSessions));
      setText('revOther', £(otherIncome));
      setText('revTotal', £(revTotal));
      setText('directTotal', £(directTotal));
      setText('overheadTotal', £(overheadTotal));

      const profitEl = root.querySelector('#netProfit');
      profitEl.textContent = £(netProfit);
      profitEl.classList.toggle('good', netProfit >= 0);
      profitEl.classList.toggle('bad', netProfit < 0);

      const pill = root.querySelector('#netMarginPill');
      const pct = margin * 100;
      pill.textContent = isFinite(pct) ? pct.toFixed(0) + '%' : '—';
      pill.classList.remove('good','mid','bad');
      if (pct >= 35) pill.classList.add('good');
      else if (pct >= 15) pill.classList.add('mid');
      else pill.classList.add('bad');
    }

    function applyScenario(key){
      const s = scenarios[key] || scenarios.gym_flat;
      activeScenarioKey = key;

      setInputs(s.defaults);
      root.querySelector('#scenarioNote').textContent = 'Scenario note: ' + s.note;

      root.querySelectorAll('.tab').forEach(btn => {
        btn.setAttribute('aria-selected', btn.dataset.scn === key ? 'true' : 'false');
      });

      recalc();
    }

    // Event wiring
    root.querySelectorAll('input').forEach(inp => inp.addEventListener('input', recalc));
    root.querySelectorAll('.hs').forEach(btn => btn.addEventListener('click', () => showTopic(btn.dataset.topic)));
    root.querySelectorAll('.tab').forEach(btn => btn.addEventListener('click', () => applyScenario(btn.dataset.scn)));

    // Start
    applyScenario('gym_flat');
    showTopic('revenue');
  });
</script>

</body>
</html>
